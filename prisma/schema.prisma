generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Role {
  id    Int     @id @default(autoincrement())
  idnty String  @unique @default(uuid())
  name  String  @unique
  isDel Boolean @default(false)
  orgs  Org[]
  users User[]

  @@map("ace_role")
}

model User {
  identity       String          @id @default(uuid())
  id             Int             @unique @default(autoincrement())
  name           String
  email          String          @unique
  password       String
  phone          String?
  city           String?
  state          String?
  country        String?
  profileImage   String?
  isDeleted      Boolean         @default(false)
  isActive       Boolean?        @default(false)
  lastLoginAt    DateTime?
  roleId         Int?
  isAdminCreated Boolean         @default(false)
  adminCreatedBy String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  otps           OTP[]
  SocialAccount  SocialAccount[]
  role           Role?           @relation(fields: [roleId], references: [id])

  @@map("ace_user")
}

model Org {
  identity             String          @id @default(uuid())
  id                   Int             @unique @default(autoincrement())
  domainEmail          String          @unique
  password             String
  organizationName     String
  organizationCategory String
  city                 String
  state                String
  country              String
  profileImage         String?
  eventCount           Int             @default(0)
  isDeleted            Boolean         @default(false)
  isVerified           Boolean         @default(false)
  roleId               Int?
  updatedAt            DateTime?       @updatedAt
  isActive             Boolean?        @default(true)
  logoUrl              String?
  website              String?
  isAdminCreated       Boolean         @default(false)
  adminCreatedBy       String?
  createdAt            DateTime        @default(now())
  slug                 String?         @unique
  Collaborator         Collaborator[]
  events               Event[]
  role                 Role?           @relation(fields: [roleId], references: [id])
  socialLinks          OrgSocialLink[]
  otps                 OTP[]
  followers            Follow[]

  @@map("ace_org")
}

model OrgSocialLink {
  identity    String   @id @default(uuid())
  orgIdentity String
  platform    String
  url         String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  org         Org      @relation(fields: [orgIdentity], references: [identity], onDelete: Cascade)

  @@unique([orgIdentity, platform])
  @@map("ace_org_social_link")
}

model OTP {
  identity     String    @id @default(uuid())
  id           Int       @unique @default(autoincrement())
  email        String
  code         String
  purpose      String
  expiresAt    DateTime?
  createdAt    DateTime  @default(now())
  usedAt       DateTime?
  ipAddress    String?
  updatedAt    DateTime? @updatedAt
  userIdentity String?
  orgIdentity  String?
  org          Org?      @relation(fields: [orgIdentity], references: [identity], onDelete: Cascade)
  user         User?     @relation(fields: [userIdentity], references: [identity], onDelete: Cascade)

  @@map("ace_otp")
}

model AuthProvider {
  identity       String          @id @default(uuid())
  id             Int             @unique @default(autoincrement())
  providerName   String
  displayName    String
  status         Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  socialAccounts SocialAccount[]

  @@map("ace_auth_provider")
}

model SocialAccount {
  identity       String       @id @default(uuid())
  id             Int          @unique @default(autoincrement())
  userId         String
  providerId     String
  providerUserId String?
  providerEmail  String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  provider       AuthProvider @relation(fields: [providerId], references: [identity])
  user           User         @relation(fields: [userId], references: [identity])

  @@map("ace_social_account")
}

model AcePerk {
  identity  String      @id @default(uuid()) @map("identity")
  id        Int         @unique @default(autoincrement())
  perkName  String      @unique @map("perk_name")
  createdAt DateTime    @default(now()) @map("created_at")
  updatedAt DateTime    @updatedAt @map("updated_at")
  EventPerk EventPerk[]

  @@map("ace_perks")
}

model AceCertification {
  identity  String   @id @default(uuid()) @map("identity")
  id        Int      @unique @default(autoincrement())
  certName  String   @unique @map("cert_name")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  Event     Event[]

  @@map("ace_certification")
}

model AceCategoryType {
  identity      String          @id @default(uuid()) @map("identity")
  id            Int             @unique @default(autoincrement())
  categoryName  String          @unique @map("category_name")
  createdAt     DateTime        @default(now()) @map("created_at")
  updatedAt     DateTime        @updatedAt @map("updated_at")
  AceEventTypes AceEventTypes[]

  @@map("ace_type_of_category")
}

model AceEventTypes {
  identity         String          @id @default(uuid())
  id               Int             @unique @default(autoincrement())
  name             String
  categoryIdentity String          @map("category_identity")
  createdAt        DateTime        @default(now()) @map("created_at")
  updatedAt        DateTime        @updatedAt @map("updated_at")
  color            String?
  imageUrl         String?         @map("image_url")
  category         AceCategoryType @relation(fields: [categoryIdentity], references: [identity])

  @@unique([name, categoryIdentity])
  @@map("ace_event_types")
}

model AceAccommodation {
  identity           String               @id @default(uuid()) @map("identity")
  id                 Int                  @unique @default(autoincrement())
  accommodationName  String               @unique @map("accommodation_name")
  createdAt          DateTime             @default(now()) @map("created_at")
  updatedAt          DateTime             @updatedAt @map("updated_at")
  EventAccommodation EventAccommodation[]

  @@map("ace_accommodation")
}

model OrgCategory {
  identity     String   @id @default(uuid()) @map("identity")
  id           Int      @unique @default(autoincrement())
  categoryName String   @unique @map("category_name")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("ace_org_category")
}

model Event {
  identity               String               @id @default(uuid())
  id                     Int                  @unique @default(autoincrement())
  orgIdentity            String
  createdBy              Int?
  title                  String               @default("")
  slug                   String?              @unique
  description            String?
  publishedAt            DateTime?
  createdAt              DateTime             @default(now())
  updatedAt              DateTime             @updatedAt
  status                 EventStatus          @default(PENDING)
  bannerImages           String[]
  categoryIdentity       String?
  eligibleDeptIdentities String[]
  eventLink              String?
  eventTypeIdentity      String?
  offers                 String?
  orgCategoryIdentity    String?
  paymentLink            String?
  socialLinks            Json?
  tags                   String[]
  videoLink              String?
  mode                   EventMode            @default(ONLINE)
  certIdentity           String?
  viewCount              Int                  @default(0)
  isPaid                 Boolean              @default(false)
  likeCount              Int                  @default(0)
  shareCount             Int                  @default(0)
  Collaborator           Collaborator[]
  cert                   AceCertification?    @relation(fields: [certIdentity], references: [identity])
  org                    Org                  @relation(fields: [orgIdentity], references: [identity])
  eventAccommodations    EventAccommodation[]
  calendars              EventCalendar[]
  location               EventLocation?
  eventPerks             EventPerk[]
  tickets                Ticket[]

  @@map("ace_event")
}

model EventLocation {
  identity       String   @id @default(uuid())
  eventIdentity  String   @unique
  onlineMeetLink String?
  country        String?
  state          String?
  city           String?
  mapLink        String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  venue          String?
  event          Event    @relation(fields: [eventIdentity], references: [identity], onDelete: Cascade)

  @@map("ace_event_location")
}

model CollaboratorMember {
  identity         String         @id @default(uuid())
  id               Int            @unique @default(autoincrement())
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  hostIdentity     String?
  location         String?
  orgDept          String?
  organizationName String?
  organizerName    String?
  organizerNumber  String
  collaborations   Collaborator[]

  @@map("ace_collaborator_members")
}

model Collaborator {
  identity             String             @id @default(uuid())
  id                   Int                @unique @default(autoincrement())
  collaboratorMemberId String
  orgIdentity          String
  eventIdentity        String
  role                 String?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  member               CollaboratorMember @relation(fields: [collaboratorMemberId], references: [identity])
  event                Event              @relation(fields: [eventIdentity], references: [identity])
  org                  Org                @relation(fields: [orgIdentity], references: [identity])

  @@unique([collaboratorMemberId, eventIdentity])
  @@map("ace_collaborator")
}

model EventCalendar {
  identity      String   @id @default(uuid())
  eventIdentity String
  timeZone      String
  startDate     String
  endDate       String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  endTime       String?
  startTime     String?
  event         Event    @relation(fields: [eventIdentity], references: [identity])

  @@map("ace_event_calendar")
}

model Ticket {
  identity      String   @id @default(uuid())
  id            Int      @unique @default(autoincrement())
  eventIdentity String
  name          String
  description   String?
  sellingFrom   DateTime
  sellingTo     DateTime
  isPaid        Boolean  @default(false)
  price         Float?
  totalQuantity Int
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  event         Event    @relation(fields: [eventIdentity], references: [identity])

  @@map("ace_event_ticket")
}

model EventPerk {
  eventIdentity String
  perkIdentity  String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  event         Event    @relation(fields: [eventIdentity], references: [identity])
  perk          AcePerk  @relation(fields: [perkIdentity], references: [identity])

  @@id([eventIdentity, perkIdentity])
  @@map("ace_event_perk")
}

model EventAccommodation {
  eventIdentity         String
  accommodationIdentity String
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt
  accommodation         AceAccommodation @relation(fields: [accommodationIdentity], references: [identity])
  event                 Event            @relation(fields: [eventIdentity], references: [identity])

  @@id([eventIdentity, accommodationIdentity])
  @@map("ace_event_accommodation")
}

model Country {
  identity  String   @id @default(uuid())
  name      String   @unique
  code      String?  @unique
  phoneCode String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  states    State[]

  @@map("ace_countries")
}

model State {
  identity  String   @id @default(uuid())
  name      String
  code      String?
  countryId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  cities    City[]
  country   Country  @relation(fields: [countryId], references: [identity], onDelete: Cascade)

  @@unique([name, countryId])
  @@map("ace_states")
}

model City {
  identity  String   @id @default(uuid())
  name      String
  stateId   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  state     State    @relation(fields: [stateId], references: [identity], onDelete: Cascade)

  @@unique([name, stateId])
  @@map("ace_cities")
}

model AceDepartment {
  identity  String   @id @default(uuid())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("ace_department")
}

model AceEligibleDepartment {
  identity  String   @id @default(uuid())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("ace_eligible_department")
}

model EventSave {
  identity      String   @id @default(uuid())
  eventIdentity String
  userIdentity  String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([eventIdentity, userIdentity])
  @@map("ace_event_save")
}

model EventLike {
  identity      String   @id @default(uuid())
  eventIdentity String
  userIdentity  String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([eventIdentity, userIdentity])
  @@map("ace_event_like")
}

model Follow {
  identity String @id @default(uuid())

  followerType String // "USER" | "ORG"
  followerId   String // user.identity OR org.identity

  followingOrgId String

  createdAt DateTime @default(now())

  followingOrg Org @relation(fields: [followingOrgId], references: [identity])

  @@unique([followerType, followerId, followingOrgId])
  @@map("ace_follow")
}

enum EventStatus {
  DRAFT
  PENDING
  APPROVED
  REJECTED
  PRIVATE
}

enum EventMode {
  ONLINE
  OFFLINE
  HYBRID
}
