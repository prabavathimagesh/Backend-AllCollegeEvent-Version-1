generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Role {
  id    Int    @id @default(autoincrement())
  idnty String @unique @default(uuid())

  name  String
  isDel Boolean @default(false)

  users User[]
  orgs  Org[]

  @@unique([name])
  @@map("ace_role")
}

model User {
  identity String @id @default(uuid())
  id       Int    @unique @default(autoincrement())

  name     String
  email    String @unique
  password String

  phone        String?
  city         String?
  state        String?
  country      String?
  profileImage String?

  isDeleted   Boolean   @default(false)
  isActive    Boolean?  @default(false)
  lastLoginAt DateTime?

  roleId Int?
  role   Role? @relation(fields: [roleId], references: [id])

  isAdminCreated Boolean @default(false)
  adminCreatedBy String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  otps          OTP[]
  events        Event[]
  SocialAccount SocialAccount[]

  @@map("ace_user")
}

model Org {
  identity String @id @default(uuid())
  id       Int    @unique @default(autoincrement())

  domainEmail String @unique
  password    String

  organizationName     String
  organizationCategory String
  city                 String
  state                String
  country              String
  profileImage         String?

  eventCount Int     @default(0)
  isDeleted  Boolean @default(false)
  isVerified Boolean @default(false)

  roleId Int?
  role   Role? @relation(fields: [roleId], references: [id])

  updatedAt DateTime? @updatedAt
  isActive  Boolean?  @default(true)
  logoUrl   String?
  website   String?

  isAdminCreated Boolean @default(false)
  adminCreatedBy String?

  createdAt DateTime @default(now())

  otps         OTP[]
  events       Event[]
  Collaborator Collaborator[]

  socialLinks  OrgSocialLink[]  

  @@map("ace_org")
}

model OrgSocialLink {
  identity String @id @default(uuid())

  orgIdentity String
  platform    String   // facebook, instagram, youtube, x, telegram, whatsapp
  url         String

  org Org @relation(fields: [orgIdentity], references: [identity], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([orgIdentity, platform])
  @@map("ace_org_social_link")
}

model OTP {
  identity String @id @default(uuid())
  id       Int    @unique @default(autoincrement())

  email   String
  code    String
  purpose String

  expiresAt DateTime?
  createdAt DateTime  @default(now())

  usedAt    DateTime?
  ipAddress String?

  updatedAt DateTime? @updatedAt

  userIdentity String?
  user         User?   @relation(fields: [userIdentity], references: [identity], onDelete: Cascade)

  orgIdentity String?
  org         Org?    @relation(fields: [orgIdentity], references: [identity], onDelete: Cascade)

  @@map("ace_otp")
}

// ENUM FOR EVENT STATUS
enum EventStatus {
  DRAFT
  PENDING
  APPROVED
  REJECTED
  PRIVATE
}

model AuthProvider {
  identity     String   @id @default(uuid())
  id           Int      @unique @default(autoincrement())
  providerName String
  displayName  String
  status       Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  socialAccounts SocialAccount[]

  @@map("ace_auth_provider")
}

model SocialAccount {
  identity       String  @id @default(uuid())
  id             Int     @unique @default(autoincrement())
  userId         String
  providerId     String
  providerUserId String?
  providerEmail  String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user     User         @relation(fields: [userId], references: [identity])
  provider AuthProvider @relation(fields: [providerId], references: [identity])

  @@map("ace_social_account")
}

model AcePerk {
  identity String @id @default(uuid()) @map("identity")
  id       Int    @unique @default(autoincrement())

  perkName String @unique @map("perk_name")

  createdAt DateTime    @default(now()) @map("created_at")
  updatedAt DateTime    @updatedAt @map("updated_at")
  EventPerk EventPerk[]

  @@map("ace_perks")
}

model AceCertification {
  identity String @id @default(uuid()) @map("identity")
  id       Int    @unique @default(autoincrement())

  certName String @unique @map("cert_name")

  createdAt          DateTime             @default(now()) @map("created_at")
  updatedAt          DateTime             @updatedAt @map("updated_at")
  Event              Event[]

  @@map("ace_certification")
}

model AceCategoryType {
  identity String @id @default(uuid()) @map("identity")
  id       Int    @unique @default(autoincrement())

  categoryName String @unique @map("category_name")

  createdAt     DateTime        @default(now()) @map("created_at")
  updatedAt     DateTime        @updatedAt @map("updated_at")
  AceEventTypes AceEventTypes[]

  @@map("ace_type_of_category")
}

model AceEventTypes {
  identity String @id @default(uuid())
  id       Int    @unique @default(autoincrement())

  name String

  categoryIdentity String          @map("category_identity")
  category         AceCategoryType @relation(fields: [categoryIdentity], references: [identity])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([name, categoryIdentity])
  @@map("ace_event_types")
}

model AceAccommodation {
  identity String @id @default(uuid()) @map("identity")
  id       Int    @unique @default(autoincrement())

  accommodationName String @unique @map("accommodation_name")

  createdAt          DateTime             @default(now()) @map("created_at")
  updatedAt          DateTime             @updatedAt @map("updated_at")
  EventAccommodation EventAccommodation[]

  @@map("ace_accommodation")
}

model OrgCategory {
  identity String @id @default(uuid()) @map("identity")
  id       Int    @unique @default(autoincrement())

  categoryName String @unique @map("category_name")

  createdAt          DateTime             @default(now()) @map("created_at")
  updatedAt          DateTime             @updatedAt @map("updated_at")
  CollaboratorMember CollaboratorMember[]

  @@map("ace_org_category")
}

model Event {
  identity String @id @default(uuid())
  id       Int    @unique @default(autoincrement())

  // Organization
  orgIdentity         String
  orgCategoryIdentity String?
  createdBy           Int?

  // Core Event
  title       String      @default("")
  slug        String?     @unique
  description String?
  offers      String?
  mode        EventMode   @default(ONLINE)
  status      EventStatus @default(PENDING)

  // Category & Type
  categoryIdentity  String?
  eventTypeIdentity String?

  // Certification (NEW)
  certIdentity String? // FK to AceCertification

  // Eligibility
  eligibleDeptIdentities String[]

  // Tags
  tags String[]

  // Media
  bannerImages String[]
  videoLink    String?
  eventLink    String?
  socialLinks  Json?

  // Payment
  paymentLink String?

  // Relations
  org  Org               @relation(fields: [orgIdentity], references: [identity])
  cert AceCertification? @relation(fields: [certIdentity], references: [identity])

  location EventLocation?

  calendars           EventCalendar[]
  tickets             Ticket[]
  eventPerks          EventPerk[]
  eventAccommodations EventAccommodation[]

  publishedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  userIdentity       String?
  User               User?                @relation(fields: [userIdentity], references: [identity])
  Collaborator       Collaborator[]

  @@map("ace_event")
}

model EventLocation {
  identity String @id @default(uuid())

  eventIdentity String @unique
  event         Event  @relation(fields: [eventIdentity], references: [identity], onDelete: Cascade)

  // ONLINE
  onlineMeetLink String?

  // OFFLINE
  country String?
  state   String?
  city    String?
  mapLink String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("ace_event_location")
}

model CollaboratorMember {
  identity String @id @default(uuid())
  id       Int    @unique @default(autoincrement())

  organizerNumber  String 
  hostIdentity     String?  
  organizerName    String?
  organizationName String?
  orgDept          String?
  location         String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  collaborations Collaborator[]

  host OrgCategory? @relation(fields: [hostIdentity], references: [identity])

  @@map("ace_collaborator_members")
}


model Collaborator {
  identity String @id @default(uuid())
  id       Int    @unique @default(autoincrement())

  collaboratorMemberId String
  eventIdentity        String
  orgIdentity          String // event creator org

  role String? // primary_host | co_host | speaker | organizer

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  member CollaboratorMember @relation(fields: [collaboratorMemberId], references: [identity])
  event  Event              @relation(fields: [eventIdentity], references: [identity])
  org    Org                @relation(fields: [orgIdentity], references: [identity])

  // Prevent duplicate collaborator per event
  @@unique([collaboratorMemberId, eventIdentity])
  @@map("ace_collaborator")
}

model EventCalendar {
  identity String @id @default(uuid())

  eventIdentity String
  timeZone      String

  startDate String
  endDate   String
  startTime String?
  endTime   String?

  event Event @relation(fields: [eventIdentity], references: [identity])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("ace_event_calendar")
}

model Ticket {
  identity String @id @default(uuid())
  id       Int    @unique @default(autoincrement())

  eventIdentity String

  name          String
  description   String?
  sellingFrom   DateTime
  sellingTo     DateTime
  isPaid        Boolean  @default(false)
  price         Float?
  totalQuantity Int

  event Event @relation(fields: [eventIdentity], references: [identity])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("ace_event_ticket")
}

model EventPerk {
  eventIdentity String
  perkIdentity  String

  event Event   @relation(fields: [eventIdentity], references: [identity])
  perk  AcePerk @relation(fields: [perkIdentity], references: [identity])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@id([eventIdentity, perkIdentity])
  @@map("ace_event_perk")
}

model EventAccommodation {
  eventIdentity         String
  accommodationIdentity String

  event         Event            @relation(fields: [eventIdentity], references: [identity])
  accommodation AceAccommodation @relation(fields: [accommodationIdentity], references: [identity])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@id([eventIdentity, accommodationIdentity])
  @@map("ace_event_accommodation")
}

// ENUM for EVENT MODE
enum EventMode {
  ONLINE
  OFFLINE
  HYBRID
}
